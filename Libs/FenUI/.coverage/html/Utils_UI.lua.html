<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Coverage Report: ADDON_DEV_LOCAL/Libs/FenUI - Utils\UI.lua</title>
    <style>
        :root {
            --bg: #1e1e2e;
            --surface: #313244;
            --text: #cdd6f4;
            --subtext: #a6adc8;
            --green: #a6e3a1;
            --yellow: #f9e2af;
            --red: #f38ba8;
            --blue: #89b4fa;
            --border: #45475a;
        }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background: var(--bg);
            color: var(--text);
            line-height: 1.6;
            padding: 2rem;
        }
        .container { max-width: 1200px; margin: 0 auto; }
        h1 {
            color: var(--blue);
            margin-bottom: 0.5rem;
            font-size: 1.75rem;
        }
        .timestamp {
            color: var(--subtext);
            font-size: 0.875rem;
            margin-bottom: 2rem;
        }
        .summary-card {
            background: var(--surface);
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            display: flex;
            gap: 2rem;
            flex-wrap: wrap;
        }
        .stat {
            text-align: center;
        }
        .stat-value {
            font-size: 2.5rem;
            font-weight: 700;
        }
        .stat-label {
            color: var(--subtext);
            font-size: 0.875rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        .coverage-high { color: var(--green); }
        .coverage-medium { color: var(--yellow); }
        .coverage-low { color: var(--red); }
        table {
            width: 100%;
            border-collapse: collapse;
            background: var(--surface);
            border-radius: 12px;
            overflow: hidden;
        }
        th, td {
            padding: 0.875rem 1rem;
            text-align: left;
            border-bottom: 1px solid var(--border);
        }
        th {
            background: rgba(0,0,0,0.2);
            font-weight: 600;
            color: var(--subtext);
            text-transform: uppercase;
            font-size: 0.75rem;
            letter-spacing: 0.05em;
        }
        tr:hover { background: rgba(255,255,255,0.02); }
        tr:last-child td { border-bottom: none; }
        .file-link {
            color: var(--blue);
            text-decoration: none;
        }
        .file-link:hover { text-decoration: underline; }
        .progress-bar {
            width: 100px;
            height: 8px;
            background: var(--border);
            border-radius: 4px;
            overflow: hidden;
        }
        .progress-fill {
            height: 100%;
            border-radius: 4px;
            transition: width 0.3s ease;
        }
        .text-right { text-align: right; }
        .file-detail {
            background: var(--surface);
            border-radius: 12px;
            margin-top: 2rem;
            overflow: hidden;
        }
        .file-header {
            padding: 1rem 1.5rem;
            background: rgba(0,0,0,0.2);
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .file-name {
            font-family: 'Consolas', 'Monaco', monospace;
            color: var(--blue);
        }
        .code-view {
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 0.875rem;
            overflow-x: auto;
        }
        .code-line {
            display: flex;
            min-height: 1.5rem;
        }
        .line-number {
            width: 50px;
            padding: 0 0.75rem;
            text-align: right;
            color: var(--subtext);
            user-select: none;
            flex-shrink: 0;
            background: rgba(0,0,0,0.1);
        }
        .line-content {
            flex: 1;
            padding: 0 1rem;
            white-space: pre;
        }
        .line-covered {
            background: rgba(166, 227, 161, 0.1);
        }
        .line-uncovered {
            background: rgba(243, 139, 168, 0.15);
        }
        .line-uncovered .line-number {
            background: rgba(243, 139, 168, 0.2);
            color: var(--red);
        }
        .nav { margin-bottom: 1rem; }
        .nav a {
            color: var(--blue);
            text-decoration: none;
            margin-right: 1rem;
        }
        .nav a:hover { text-decoration: underline; }
    </style>
</head>
<body>
    <div class="container">
        
        <div class="nav">
            <a href="index.html">‚Üê Back to Summary</a>
        </div>
        
        <div class="file-detail">
            <div class="file-header">
                <span class="file-name">Utils\UI.lua</span>
                <span class="coverage-medium">79.1% (170/215 lines)</span>
            </div>
            <div class="code-view">
    
                <div class="code-line ">
                    <span class="line-number">1</span>
                    <span class="line-content">--------------------------------------------------------------------------------</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">2</span>
                    <span class="line-content">-- FenUI.Utils.UI</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">3</span>
                    <span class="line-content">-- UI helpers, frame resolution, and visibility guards.</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">4</span>
                    <span class="line-content">--------------------------------------------------------------------------------</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">5</span>
                    <span class="line-content"></span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">6</span>
                    <span class="line-content">local Utils = FenUI.Utils</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">7</span>
                    <span class="line-content"></span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">8</span>
                    <span class="line-content">--- Returns the current mouse focus frame.</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">9</span>
                    <span class="line-content">---@return Frame|nil focus</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">10</span>
                    <span class="line-content">function Utils:GetMouseFocus()</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">11</span>
                    <span class="line-content">	if C_UI and C_UI.GetMouseFocus then</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">12</span>
                    <span class="line-content">		return C_UI.GetMouseFocus()</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">13</span>
                    <span class="line-content">	elseif _G.GetMouseFocus then</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">14</span>
                    <span class="line-content">		return _G.GetMouseFocus()</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">15</span>
                    <span class="line-content">	else</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">16</span>
                    <span class="line-content">		local foci = GetMouseFoci()</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">17</span>
                    <span class="line-content">		return foci and foci[1]</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">18</span>
                    <span class="line-content">	end</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">19</span>
                    <span class="line-content">end</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">20</span>
                    <span class="line-content"></span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">21</span>
                    <span class="line-content">--- Safe frame hiding that avoids combat taint and handles secret visibility.</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">22</span>
                    <span class="line-content">---@param frame Frame|nil</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">23</span>
                    <span class="line-content">function Utils:HideSafe(frame)</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">24</span>
                    <span class="line-content">	if not frame then</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">25</span>
                    <span class="line-content">		return</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">26</span>
                    <span class="line-content">	end</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">27</span>
                    <span class="line-content">	if InCombatLockdown() or self.IS_MIDNIGHT then</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">28</span>
                    <span class="line-content">		frame:SetAlpha(0)</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">29</span>
                    <span class="line-content">	else</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">30</span>
                    <span class="line-content">		frame:Hide()</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">31</span>
                    <span class="line-content">		frame:SetAlpha(0)</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">32</span>
                    <span class="line-content">	end</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">33</span>
                    <span class="line-content">end</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">34</span>
                    <span class="line-content"></span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">35</span>
                    <span class="line-content">--- Strips Blizzard decorations (borders, masks) from a frame.</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">36</span>
                    <span class="line-content">---@param frame Frame|nil</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">37</span>
                    <span class="line-content">function Utils:StripBlizzardDecorations(frame)</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">38</span>
                    <span class="line-content">	if not frame then</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">39</span>
                    <span class="line-content">		return</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">40</span>
                    <span class="line-content">	end</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">41</span>
                    <span class="line-content">	local regions = { frame:GetRegions() }</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">42</span>
                    <span class="line-content">	local inCombat = InCombatLockdown()</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">43</span>
                    <span class="line-content"></span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">44</span>
                    <span class="line-content">	for _, region in ipairs(regions) do</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">45</span>
                    <span class="line-content">		if region:IsObjectType(&quot;MaskTexture&quot;) or region:IsObjectType(&quot;Texture&quot;) then</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">46</span>
                    <span class="line-content">			local name = region:GetDebugName()</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">47</span>
                    <span class="line-content">			if name and (name:find(&quot;Border&quot;) or name:find(&quot;Overlay&quot;) or name:find(&quot;Mask&quot;)) then</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">48</span>
                    <span class="line-content">				if inCombat then</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">49</span>
                    <span class="line-content">					region:SetAlpha(0)</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">50</span>
                    <span class="line-content">				else</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">51</span>
                    <span class="line-content">					region:Hide()</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">52</span>
                    <span class="line-content">				end</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">53</span>
                    <span class="line-content">			end</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">54</span>
                    <span class="line-content">		end</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">55</span>
                    <span class="line-content">	end</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">56</span>
                    <span class="line-content">end</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">57</span>
                    <span class="line-content"></span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">58</span>
                    <span class="line-content">--- Applies standardized icon crop to a texture.</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">59</span>
                    <span class="line-content">---@param texture Texture|nil</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">60</span>
                    <span class="line-content">---@param w number</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">61</span>
                    <span class="line-content">---@param h number</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">62</span>
                    <span class="line-content">function Utils:ApplyIconCrop(texture, w, h)</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">63</span>
                    <span class="line-content">	if not texture or not w or not h then</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">64</span>
                    <span class="line-content">		return</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">65</span>
                    <span class="line-content">	end</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">66</span>
                    <span class="line-content">	local ratio = w / h</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">67</span>
                    <span class="line-content">	if ratio &gt; 1 then</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">68</span>
                    <span class="line-content">		local scale = h / w</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">69</span>
                    <span class="line-content">		local range = 0.84 * scale</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">70</span>
                    <span class="line-content">		local mid = 0.5</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">71</span>
                    <span class="line-content">		texture:SetTexCoord(0.08, 0.92, mid - range / 2, mid + range / 2)</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">72</span>
                    <span class="line-content">	elseif ratio &lt; 1 then</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">73</span>
                    <span class="line-content">		local scale = w / h</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">74</span>
                    <span class="line-content">		local range = 0.84 * scale</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">75</span>
                    <span class="line-content">		local mid = 0.5</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">76</span>
                    <span class="line-content">		texture:SetTexCoord(mid - range / 2, mid + range / 2, 0.08, 0.92)</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">77</span>
                    <span class="line-content">	else</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">78</span>
                    <span class="line-content">		texture:SetTexCoord(0.08, 0.92, 0.08, 0.92)</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">79</span>
                    <span class="line-content">	end</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">80</span>
                    <span class="line-content">end</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">81</span>
                    <span class="line-content"></span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">82</span>
                    <span class="line-content">--- Aggressively hides a texture.</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">83</span>
                    <span class="line-content">---@param texture Texture|nil</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">84</span>
                    <span class="line-content">function Utils:HideTexture(texture)</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">85</span>
                    <span class="line-content">	if not texture then</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">86</span>
                    <span class="line-content">		return</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">87</span>
                    <span class="line-content">	end</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">88</span>
                    <span class="line-content">	texture:SetAlpha(0)</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">89</span>
                    <span class="line-content">	texture:Hide()</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">90</span>
                    <span class="line-content">	if texture.SetTexture then</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">91</span>
                    <span class="line-content">		texture:SetTexture(nil)</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">92</span>
                    <span class="line-content">	end</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">93</span>
                    <span class="line-content">	if texture.SetAtlas then</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">94</span>
                    <span class="line-content">		texture:SetAtlas(nil)</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">95</span>
                    <span class="line-content">	end</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">96</span>
                    <span class="line-content">end</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">97</span>
                    <span class="line-content"></span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">98</span>
                    <span class="line-content">--- Wrapper for Blizzard EasyMenu or modern MenuUtil.</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">99</span>
                    <span class="line-content">---@param menuList table Array of menu definitions (EasyMenu format)</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">100</span>
                    <span class="line-content">---@param anchor Frame|string|nil Anchor point or frame (default: &quot;cursor&quot;)</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">101</span>
                    <span class="line-content">function Utils:ShowMenu(menuList, anchor)</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">102</span>
                    <span class="line-content">	if not menuList or #menuList == 0 then</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">103</span>
                    <span class="line-content">		return</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">104</span>
                    <span class="line-content">	end</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">105</span>
                    <span class="line-content"></span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">106</span>
                    <span class="line-content">	-- 1. Modern Client (11.0+) - MenuUtil</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">107</span>
                    <span class="line-content">	local mu = _G.MenuUtil</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">108</span>
                    <span class="line-content">	if mu and mu.CreateContextMenu then</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">109</span>
                    <span class="line-content">		mu.CreateContextMenu(UIParent, function(owner, rootDescription)</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">110</span>
                    <span class="line-content">			for _, info in ipairs(menuList) do</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">111</span>
                    <span class="line-content">				if info.isTitle then</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">112</span>
                    <span class="line-content">					rootDescription:CreateTitle(info.text)</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">113</span>
                    <span class="line-content">				elseif info.hasArrow then</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">114</span>
                    <span class="line-content">					-- Submenu support (recursive)</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">115</span>
                    <span class="line-content">					local submenu = rootDescription:CreateButton(info.text)</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">116</span>
                    <span class="line-content">					-- Note: Minimal implementation for now, enough for basic needs</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">117</span>
                    <span class="line-content">				elseif info.text == nil or info.text == &quot;&quot; then</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">118</span>
                    <span class="line-content">					rootDescription:CreateDivider()</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">119</span>
                    <span class="line-content">				else</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">120</span>
                    <span class="line-content">					local btn = rootDescription:CreateButton(info.text, info.func)</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">121</span>
                    <span class="line-content">					if info.notCheckable == false or info.checked ~= nil then</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">122</span>
                    <span class="line-content">						-- Checkbox/Radio support if needed</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">123</span>
                    <span class="line-content">						-- luacheck: ignore 542</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">124</span>
                    <span class="line-content">					end</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">125</span>
                    <span class="line-content">				end</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">126</span>
                    <span class="line-content">			end</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">127</span>
                    <span class="line-content">		end)</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">128</span>
                    <span class="line-content">		return</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">129</span>
                    <span class="line-content">	end</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">130</span>
                    <span class="line-content"></span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">131</span>
                    <span class="line-content">	-- 2. Legacy Fallback - EasyMenu</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">132</span>
                    <span class="line-content">	local em = _G.EasyMenu</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">133</span>
                    <span class="line-content">	if em then</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">134</span>
                    <span class="line-content">		if not self.menuFrame then</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">135</span>
                    <span class="line-content">			self.menuFrame = CreateFrame(&quot;Frame&quot;, &quot;FenUIMenuFrame&quot;, UIParent, &quot;UIDropDownMenuTemplate&quot;)</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">136</span>
                    <span class="line-content">		end</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">137</span>
                    <span class="line-content">		em(menuList, self.menuFrame, anchor or &quot;cursor&quot;, 0, 0, &quot;MENU&quot;)</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">138</span>
                    <span class="line-content">		return</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">139</span>
                    <span class="line-content">	end</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">140</span>
                    <span class="line-content"></span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">141</span>
                    <span class="line-content">	-- 3. Last resort (should not happen if libraries are present)</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">142</span>
                    <span class="line-content">	print(&quot;|cffff4444[FenUI Error]|r No menu system available (EasyMenu and MenuUtil both missing).&quot;)</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">143</span>
                    <span class="line-content">end</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">144</span>
                    <span class="line-content"></span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">145</span>
                    <span class="line-content">--- Resolve a size value (number or responsive string) to pixels.</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">146</span>
                    <span class="line-content">--- Supports:</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">147</span>
                    <span class="line-content">--- - number: direct pixels</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">148</span>
                    <span class="line-content">--- - &quot;50%&quot;: percentage of relativeTo</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">149</span>
                    <span class="line-content">--- - &quot;10vh&quot;: 10% of viewport height</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">150</span>
                    <span class="line-content">--- - &quot;10vw&quot;: 10% of viewport width</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">151</span>
                    <span class="line-content">--- - &quot;100px&quot;: explicit pixels</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">152</span>
                    <span class="line-content">--- - &quot;auto&quot;: returns -1 (marker for intrinsic sizing)</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">153</span>
                    <span class="line-content">---@param value number|string The value to resolve</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">154</span>
                    <span class="line-content">---@param relativeTo number The pixel value to calculate percentages against</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">155</span>
                    <span class="line-content">---@param isHeight boolean Whether this is a height calculation (for vh/vw)</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">156</span>
                    <span class="line-content">---@return number pixels</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">157</span>
                    <span class="line-content">function Utils:ParseSize(value, relativeTo, isHeight)</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">158</span>
                    <span class="line-content">	if not value then</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">159</span>
                    <span class="line-content">		return 0</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">160</span>
                    <span class="line-content">	end</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">161</span>
                    <span class="line-content">	if type(value) == &quot;number&quot; then</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">162</span>
                    <span class="line-content">		return value</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">163</span>
                    <span class="line-content">	end</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">164</span>
                    <span class="line-content"></span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">165</span>
                    <span class="line-content">	if type(value) == &quot;string&quot; then</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">166</span>
                    <span class="line-content">		if value == &quot;auto&quot; then</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">167</span>
                    <span class="line-content">			return -1</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">168</span>
                    <span class="line-content">		end</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">169</span>
                    <span class="line-content"></span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">170</span>
                    <span class="line-content">		-- 1. Pixels (e.g. &quot;100px&quot;)</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">171</span>
                    <span class="line-content">		local px = value:match(&quot;^(%d+)px$&quot;)</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">172</span>
                    <span class="line-content">		if px then</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">173</span>
                    <span class="line-content">			return tonumber(px)</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">174</span>
                    <span class="line-content">		end</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">175</span>
                    <span class="line-content"></span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">176</span>
                    <span class="line-content">		-- 2. Percentages (e.g. &quot;50%&quot;)</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">177</span>
                    <span class="line-content">		local pct = value:match(&quot;^(%d+)%%$&quot;)</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">178</span>
                    <span class="line-content">		if pct then</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">179</span>
                    <span class="line-content">			return (tonumber(pct) / 100) * (relativeTo or 0)</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">180</span>
                    <span class="line-content">		end</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">181</span>
                    <span class="line-content"></span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">182</span>
                    <span class="line-content">		-- 3. Viewport Units (vh/vw)</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">183</span>
                    <span class="line-content">		local vUnit = value:match(&quot;^(%d+)v[hw]$&quot;)</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">184</span>
                    <span class="line-content">		if vUnit then</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">185</span>
                    <span class="line-content">			local unitType = value:match(&quot;v([hw])$&quot;)</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">186</span>
                    <span class="line-content">			local viewportSize = (unitType == &quot;h&quot;) and UIParent:GetHeight() or UIParent:GetWidth()</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">187</span>
                    <span class="line-content">			return (tonumber(vUnit) / 100) * viewportSize</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">188</span>
                    <span class="line-content">		end</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">189</span>
                    <span class="line-content">	end</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">190</span>
                    <span class="line-content"></span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">191</span>
                    <span class="line-content">	return tonumber(value) or 0</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">192</span>
                    <span class="line-content">end</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">193</span>
                    <span class="line-content"></span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">194</span>
                    <span class="line-content">--- Parses an aspect ratio string or number.</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">195</span>
                    <span class="line-content">--- Supports: 1.777, &quot;16:9&quot;, &quot;4/3&quot;</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">196</span>
                    <span class="line-content">---@param value string|number</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">197</span>
                    <span class="line-content">---@return number|nil</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">198</span>
                    <span class="line-content">function Utils:ParseAspectRatio(value)</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">199</span>
                    <span class="line-content">	if not value then</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">200</span>
                    <span class="line-content">		return nil</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">201</span>
                    <span class="line-content">	end</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">202</span>
                    <span class="line-content">	if type(value) == &quot;number&quot; then</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">203</span>
                    <span class="line-content">		return value</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">204</span>
                    <span class="line-content">	end</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">205</span>
                    <span class="line-content">	if type(value) == &quot;string&quot; then</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">206</span>
                    <span class="line-content">		-- 16:9 or 4/3</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">207</span>
                    <span class="line-content">		local w, h = value:match(&quot;^(%d+)[:/](%d+)$&quot;)</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">208</span>
                    <span class="line-content">		if w and h then</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">209</span>
                    <span class="line-content">			return tonumber(w) / tonumber(h)</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">210</span>
                    <span class="line-content">		end</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">211</span>
                    <span class="line-content">		return tonumber(value)</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">212</span>
                    <span class="line-content">	end</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">213</span>
                    <span class="line-content">	return nil</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">214</span>
                    <span class="line-content">end</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">215</span>
                    <span class="line-content"></span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">216</span>
                    <span class="line-content">--- Internal storage for resize hooks to avoid multiple hooks on same parent</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">217</span>
                    <span class="line-content">local parentResizeHooks = {}</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">218</span>
                    <span class="line-content"></span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">219</span>
                    <span class="line-content">--- Hooks a parent&#x27;s OnSizeChanged to notify children.</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">220</span>
                    <span class="line-content">---@param child Frame The child frame to notify</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">221</span>
                    <span class="line-content">---@param parent Frame The parent frame to watch</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">222</span>
                    <span class="line-content">function Utils:HookParentResize(child, parent)</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">223</span>
                    <span class="line-content">	if not parent or parent == UIParent then</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">224</span>
                    <span class="line-content">		return</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">225</span>
                    <span class="line-content">	end</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">226</span>
                    <span class="line-content"></span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">227</span>
                    <span class="line-content">	if not parentResizeHooks[parent] then</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">228</span>
                    <span class="line-content">		parentResizeHooks[parent] = {}</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">229</span>
                    <span class="line-content">		parent:HookScript(&quot;OnSizeChanged&quot;, function()</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">230</span>
                    <span class="line-content">			for _, c in ipairs(parentResizeHooks[parent]) do</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">231</span>
                    <span class="line-content">				if c.UpdateDynamicSize then</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">232</span>
                    <span class="line-content">					c:UpdateDynamicSize()</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">233</span>
                    <span class="line-content">				end</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">234</span>
                    <span class="line-content">			end</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">235</span>
                    <span class="line-content">		end)</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">236</span>
                    <span class="line-content">	end</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">237</span>
                    <span class="line-content"></span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">238</span>
                    <span class="line-content">	-- Add child to registry if not already there</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">239</span>
                    <span class="line-content">	local found = false</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">240</span>
                    <span class="line-content">	for _, c in ipairs(parentResizeHooks[parent]) do</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">241</span>
                    <span class="line-content">		if c == child then</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">242</span>
                    <span class="line-content">			found = true</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">243</span>
                    <span class="line-content">			break</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">244</span>
                    <span class="line-content">		end</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">245</span>
                    <span class="line-content">	end</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">246</span>
                    <span class="line-content"></span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">247</span>
                    <span class="line-content">	if not found then</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">248</span>
                    <span class="line-content">		table.insert(parentResizeHooks[parent], child)</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">249</span>
                    <span class="line-content">	end</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">250</span>
                    <span class="line-content">end</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">251</span>
                    <span class="line-content"></span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">252</span>
                    <span class="line-content">--- Generic sizing handler for widgets.</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">253</span>
                    <span class="line-content">---@param frame Frame The widget frame</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">254</span>
                    <span class="line-content">---@param width number|string</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">255</span>
                    <span class="line-content">---@param height number|string</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">256</span>
                    <span class="line-content">---@param constraints table|nil { minWidth, maxWidth, minHeight, maxHeight, aspectRatio, aspectBase }</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">257</span>
                    <span class="line-content">function Utils:ApplySize(frame, width, height, constraints)</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">258</span>
                    <span class="line-content">	if not frame then</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">259</span>
                    <span class="line-content">		return</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">260</span>
                    <span class="line-content">	end</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">261</span>
                    <span class="line-content"></span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">262</span>
                    <span class="line-content">	frame.dynamicSize = { width = width, height = height }</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">263</span>
                    <span class="line-content">	frame._fenui_constraints = constraints</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">264</span>
                    <span class="line-content"></span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">265</span>
                    <span class="line-content">	-- Parse aspect ratio if provided as string</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">266</span>
                    <span class="line-content">	if constraints and constraints.aspectRatio then</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">267</span>
                    <span class="line-content">		constraints.aspectRatio = self:ParseAspectRatio(constraints.aspectRatio)</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">268</span>
                    <span class="line-content">	end</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">269</span>
                    <span class="line-content"></span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">270</span>
                    <span class="line-content">	-- Initial application</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">271</span>
                    <span class="line-content">	self:UpdateDynamicSize(frame)</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">272</span>
                    <span class="line-content"></span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">273</span>
                    <span class="line-content">	-- Check if we need to watch parent for responsive updates</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">274</span>
                    <span class="line-content">	local isResponsive = (type(width) == &quot;string&quot; and (width:find(&quot;%%&quot;) or width:find(&quot;v[hw]&quot;)))</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">275</span>
                    <span class="line-content">		or (type(height) == &quot;string&quot; and (height:find(&quot;%%&quot;) or height:find(&quot;v[hw]&quot;)))</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">276</span>
                    <span class="line-content"></span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">277</span>
                    <span class="line-content">	if isResponsive then</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">278</span>
                    <span class="line-content">		local parent = frame:GetParent() or UIParent</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">279</span>
                    <span class="line-content">		self:HookParentResize(frame, parent)</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">280</span>
                    <span class="line-content">	end</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">281</span>
                    <span class="line-content"></span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">282</span>
                    <span class="line-content">	-- Check if we need to watch children for intrinsic (auto) sizing</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">283</span>
                    <span class="line-content">	if width == &quot;auto&quot; or height == &quot;auto&quot; then</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">284</span>
                    <span class="line-content">		-- This will be handled by the widget&#x27;s content observer</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">285</span>
                    <span class="line-content">		frame.isAutoSizing = true</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">286</span>
                    <span class="line-content">	end</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">287</span>
                    <span class="line-content">end</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">288</span>
                    <span class="line-content"></span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">289</span>
                    <span class="line-content">--- Internal storage for intrinsic size observers</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">290</span>
                    <span class="line-content">local sizeObservers = {}</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">291</span>
                    <span class="line-content"></span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">292</span>
                    <span class="line-content">--- Registers an observer to update parent size when child size changes.</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">293</span>
                    <span class="line-content">---@param parent Frame The frame to resize</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">294</span>
                    <span class="line-content">---@param child Frame The child frame to watch</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">295</span>
                    <span class="line-content">function Utils:ObserveIntrinsicSize(parent, child)</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">296</span>
                    <span class="line-content">	if not parent or not child then</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">297</span>
                    <span class="line-content">		return</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">298</span>
                    <span class="line-content">	end</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">299</span>
                    <span class="line-content"></span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">300</span>
                    <span class="line-content">	if not sizeObservers[child] then</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">301</span>
                    <span class="line-content">		sizeObservers[child] = {}</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">302</span>
                    <span class="line-content">		child:HookScript(&quot;OnSizeChanged&quot;, function()</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">303</span>
                    <span class="line-content">			for _, p in ipairs(sizeObservers[child]) do</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">304</span>
                    <span class="line-content">				if p.UpdateDynamicSize then</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">305</span>
                    <span class="line-content">					p:UpdateDynamicSize()</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">306</span>
                    <span class="line-content">				end</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">307</span>
                    <span class="line-content">			end</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">308</span>
                    <span class="line-content">		end)</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">309</span>
                    <span class="line-content">	end</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">310</span>
                    <span class="line-content"></span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">311</span>
                    <span class="line-content">	-- Add parent to registry if not already there</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">312</span>
                    <span class="line-content">	local found = false</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">313</span>
                    <span class="line-content">	for _, p in ipairs(sizeObservers[child]) do</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">314</span>
                    <span class="line-content">		if p == parent then</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">315</span>
                    <span class="line-content">			found = true</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">316</span>
                    <span class="line-content">			break</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">317</span>
                    <span class="line-content">		end</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">318</span>
                    <span class="line-content">	end</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">319</span>
                    <span class="line-content"></span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">320</span>
                    <span class="line-content">	if not found then</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">321</span>
                    <span class="line-content">		table.insert(sizeObservers[child], parent)</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">322</span>
                    <span class="line-content">	end</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">323</span>
                    <span class="line-content">end</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">324</span>
                    <span class="line-content"></span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">325</span>
                    <span class="line-content">--- Updates a frame&#x27;s size based on its dynamicSize config.</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">326</span>
                    <span class="line-content">---@param frame Frame</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">327</span>
                    <span class="line-content">function Utils:UpdateDynamicSize(frame)</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">328</span>
                    <span class="line-content">	if not frame or not frame.dynamicSize then</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">329</span>
                    <span class="line-content">		return</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">330</span>
                    <span class="line-content">	end</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">331</span>
                    <span class="line-content"></span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">332</span>
                    <span class="line-content">	local parent = frame:GetParent() or UIParent</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">333</span>
                    <span class="line-content">	local pW, pH = parent:GetWidth(), parent:GetHeight()</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">334</span>
                    <span class="line-content">	local constraints = frame._fenui_constraints</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">335</span>
                    <span class="line-content"></span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">336</span>
                    <span class="line-content">	local finalW, finalH</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">337</span>
                    <span class="line-content"></span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">338</span>
                    <span class="line-content">	-- 1. Resolve base sizes</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">339</span>
                    <span class="line-content">	-- Width</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">340</span>
                    <span class="line-content">	if frame.dynamicSize.width == &quot;auto&quot; then</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">341</span>
                    <span class="line-content">		if frame.GetContentFrame then</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">342</span>
                    <span class="line-content">			local content = frame:GetContentFrame()</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">343</span>
                    <span class="line-content">			local p = frame:GetPadding()</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">344</span>
                    <span class="line-content">			local m = frame:GetMargin()</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">345</span>
                    <span class="line-content">			finalW = content:GetWidth() + p.left + p.right + m.left + m.right</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">346</span>
                    <span class="line-content">		end</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">347</span>
                    <span class="line-content">	elseif frame.dynamicSize.width then</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">348</span>
                    <span class="line-content">		finalW = self:ParseSize(frame.dynamicSize.width, pW, false)</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">349</span>
                    <span class="line-content">	end</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">350</span>
                    <span class="line-content"></span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">351</span>
                    <span class="line-content">	-- Height</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">352</span>
                    <span class="line-content">	if frame.dynamicSize.height == &quot;auto&quot; then</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">353</span>
                    <span class="line-content">		if frame.GetContentFrame then</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">354</span>
                    <span class="line-content">			local content = frame:GetContentFrame()</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">355</span>
                    <span class="line-content">			local p = frame:GetPadding()</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">356</span>
                    <span class="line-content">			local m = frame:GetMargin()</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">357</span>
                    <span class="line-content">			finalH = content:GetHeight() + p.top + p.bottom + m.top + m.bottom</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">358</span>
                    <span class="line-content">		end</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">359</span>
                    <span class="line-content">	elseif frame.dynamicSize.height then</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">360</span>
                    <span class="line-content">		finalH = self:ParseSize(frame.dynamicSize.height, pH, true)</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">361</span>
                    <span class="line-content">	end</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">362</span>
                    <span class="line-content"></span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">363</span>
                    <span class="line-content">	-- 2. Apply initial constraints</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">364</span>
                    <span class="line-content">	if finalW and constraints then</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">365</span>
                    <span class="line-content">		if constraints.minWidth then</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">366</span>
                    <span class="line-content">			finalW = math.max(finalW, self:ParseSize(constraints.minWidth, pW, false))</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">367</span>
                    <span class="line-content">		end</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">368</span>
                    <span class="line-content">		if constraints.maxWidth then</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">369</span>
                    <span class="line-content">			finalW = math.min(finalW, self:ParseSize(constraints.maxWidth, pW, false))</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">370</span>
                    <span class="line-content">		end</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">371</span>
                    <span class="line-content">	end</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">372</span>
                    <span class="line-content"></span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">373</span>
                    <span class="line-content">	if finalH and constraints then</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">374</span>
                    <span class="line-content">		if constraints.minHeight then</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">375</span>
                    <span class="line-content">			finalH = math.max(finalH, self:ParseSize(constraints.minHeight, pH, true))</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">376</span>
                    <span class="line-content">		end</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">377</span>
                    <span class="line-content">		if constraints.maxHeight then</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">378</span>
                    <span class="line-content">			finalH = math.min(finalH, self:ParseSize(constraints.maxHeight, pH, true))</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">379</span>
                    <span class="line-content">		end</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">380</span>
                    <span class="line-content">	end</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">381</span>
                    <span class="line-content"></span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">382</span>
                    <span class="line-content">	-- 3. Apply Aspect Ratio</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">383</span>
                    <span class="line-content">	if constraints and constraints.aspectRatio then</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">384</span>
                    <span class="line-content">		local ratio = constraints.aspectRatio</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">385</span>
                    <span class="line-content">		local base = constraints.aspectBase or &quot;width&quot;</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">386</span>
                    <span class="line-content"></span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">387</span>
                    <span class="line-content">		if base == &quot;width&quot; and finalW then</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">388</span>
                    <span class="line-content">			finalH = finalW / ratio</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">389</span>
                    <span class="line-content">			-- Re-apply height constraints</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">390</span>
                    <span class="line-content">			if constraints.minHeight then</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">391</span>
                    <span class="line-content">				finalH = math.max(finalH, self:ParseSize(constraints.minHeight, pH, true))</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">392</span>
                    <span class="line-content">			end</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">393</span>
                    <span class="line-content">			if constraints.maxHeight then</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">394</span>
                    <span class="line-content">				finalH = math.min(finalH, self:ParseSize(constraints.maxHeight, pH, true))</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">395</span>
                    <span class="line-content">			end</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">396</span>
                    <span class="line-content">		elseif base == &quot;height&quot; and finalH then</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">397</span>
                    <span class="line-content">			finalW = finalH * ratio</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">398</span>
                    <span class="line-content">			-- Re-apply width constraints</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">399</span>
                    <span class="line-content">			if constraints.minWidth then</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">400</span>
                    <span class="line-content">				finalW = math.max(finalW, self:ParseSize(constraints.minWidth, pW, false))</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">401</span>
                    <span class="line-content">			end</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">402</span>
                    <span class="line-content">			if constraints.maxWidth then</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">403</span>
                    <span class="line-content">				finalW = math.min(finalW, self:ParseSize(constraints.maxWidth, pW, false))</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">404</span>
                    <span class="line-content">			end</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">405</span>
                    <span class="line-content">		end</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">406</span>
                    <span class="line-content">	end</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">407</span>
                    <span class="line-content"></span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">408</span>
                    <span class="line-content">	-- 4. Apply to frame</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">409</span>
                    <span class="line-content">	if finalW then</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">410</span>
                    <span class="line-content">		frame:SetWidth(math.max(1, finalW))</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">411</span>
                    <span class="line-content">	end</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">412</span>
                    <span class="line-content">	if finalH then</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">413</span>
                    <span class="line-content">		frame:SetHeight(math.max(1, finalH))</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">414</span>
                    <span class="line-content">	end</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">415</span>
                    <span class="line-content">end</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">416</span>
                    <span class="line-content"></span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">417</span>
                    <span class="line-content">--- Generic widget factory to ensure single instance per parent.</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">418</span>
                    <span class="line-content">---@param parent table</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">419</span>
                    <span class="line-content">---@param key string</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">420</span>
                    <span class="line-content">---@param creator function</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">421</span>
                    <span class="line-content">---@return any widget</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">422</span>
                    <span class="line-content">function Utils:GetOrCreateWidget(parent, key, creator)</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">423</span>
                    <span class="line-content">	if parent[key] then</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">424</span>
                    <span class="line-content">		return parent[key]</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">425</span>
                    <span class="line-content">	end</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">426</span>
                    <span class="line-content">	local widget = creator(parent)</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">427</span>
                    <span class="line-content">	parent[key] = widget</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">428</span>
                    <span class="line-content">	return widget</span>
                </div>
        
                <div class="code-line ">
                    <span class="line-number">429</span>
                    <span class="line-content">end</span>
                </div>
        
            </div>
        </div>
    
    </div>
</body>
</html>
